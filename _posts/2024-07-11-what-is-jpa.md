---
title: "JPA란?"
description: 
author: 이원모
date: 2024-07-11
categories: [Framework, Spring]
tags: [jpa, spring, 스프링]
pin: false
math: true
mermaid: true
image:
  path: /thumbnail/spring-logo.jpg
  lqip: 
  alt: 
---

## 소개
---
Java Persistence API(JPA)는 자바 플랫폼(자바 EE)의 [ORM](https://enxec.techblog.nbyte.kr/posts/what-is-orm/) (Object-Relational Mapping) 기술 표준으로, 객체 지향 프로그래밍 언어인 자바에서 관계형 데이터베이스와 상호 작용하기 위한 방법을 제공하며, 개발자가 데이터베이스 연산을 객체 모델로 매핑하여, SQL을 직접 작성하지 않고도 데이터베이스 연산을 수행할 수 있게 해줍니다.

데이터베이스와의 상호 작용을 단순화하고, 생산성을 높이며, 유지보수를 용이하게 하고 객체 지향 프로그래밍 방식으로 데이터베이스 연산을 수행할 수 있으며, SQL 작성에 대한 부담을 덜 수 있습니다. 또한, 데이터베이스 독립성을 제공하여 다양한 DBMS와 호환이 가능합니다.

JPA는 EJB 2.0의 복잡성과 한계를 극복하기 위해 도입된 EJB 3.0 스펙의 일부로 등장했습니다. 이후 JPA 2.0, JPA 2.1, 그리고 JPA 2.2까지 발전하며 다양한 기능들이 추가되었고 현재 많은 자바 개발자들에게 널리 사용되고 있으며, Hibernate, EclipseLink, OpenJPA 등의 구현체가 있습니다.

<br>

## JPA의 주요 개념
---
- ORM

  [ORM](https://enxec.techblog.nbyte.kr/posts/what-is-orm/)은 객체 지향 프로그래밍 언어의 객체와 관계형 데이터베이스의 테이블을 자동으로 매핑하는 기술입니다. 이를 통해 개발자는 데이터베이스 연산을 객체 지향적으로 처리할 수 있으며, 데이터베이스 관련 코드를 최소화할 수 있습니다.

- 하이버네이트(Hibernate)

  Hibernate는 JPA의 대표적인 구현체 중 하나로, JPA 표준을 준수하면서도 다양한 추가 기능을 제공하여 JPA의 기능을 확장합니다. 객체 지향 언어인 자바와 관계형 데이터베이스 간의 매핑을 처리하는 데 사용되며, 특히 캐싱, 성능 최적화, 다양한 데이터베이스 방언 지원 등의 고급 기능을 갖추고 있습니다.

  > 주요 기능
  >
  >  - 캐시
  >
  >    Hibernate는 1차 캐시(세션 레벨 캐시)와 2차 캐시(세션 팩토리 레벨 캐시)를 제공하여 반복적인 데이터베이스 접근을 최소화하고 성능을 향상시킵니다.
  >
  >  - 방언(Dialect)
  >    
  >    다양한 데이터베이스에 맞춰 최적화된 SQL을 생성하는 기능을 제공하여, 여러 데이터베이스와의 호환성을 높입니다.
  >
  >  - 배치 처리
  >
  >    대량의 데이터를 효율적으로 처리할 수 있는 기능을 제공합니다.
  >
  >  - 지연 로딩(Lazy Loading)
  >
  >    필요할 때 데이터베이스에서 데이터를 로드하는 방식으로, 성능을 최적화합니다.
  >
  >  - 즉시 로딩(Eager Loading)
  >
  >    엔티티가 조회될 때 연관된 엔티티도 함께 즉시 로드하는 방식으로, 코드는 간결해질 수 있으나 성능에 영향을 미칠 수 있습니다.
  >
  >  - 고급 매핑
  >
  >    복잡한 엔티티 관계 매핑, 상속 매핑, 컬렉션 매핑 등을 지원합니다.

- 엔티티(Entity)

  엔티티는 JPA에서 데이터베이스의 테이블에 매핑되는 자바 클래스입니다. 각 엔티티는 데이터베이스 테이블의 한 행(row)을 나타내며, 엔티티 클래스의 각 필드는 테이블의 열(column)에 매핑됩니다. 엔티티는 @Entity 어노테이션을 사용하여 정의합니다.

- 관계 매핑

  엔티티 간의 관계는 JPA 어노테이션을 사용하여 매핑할 수 있습니다. 관계 매핑은 일대일(@OneToOne), 일대다(@OneToMany), 다대일(@ManyToOne), 다대다(@ManyToMany) 관계를 지원합니다.

- 영속성 컨텍스트(Persistence Context)

  영속성 컨텍스트는 JPA에서 엔티티 객체를 관리하는 환경을 말합니다. 영속성 컨텍스트는 엔티티 매니저(EntityManager)가 관리하며, 엔티티의 생명주기를 관리합니다. 엔티티는 영속성 컨텍스트에 의해 관리될 때 "영속 상태"라고 불립니다.

    > 엔티티 생명주기
    > 
    > 비영속 상태(Transient) : 엔티티가 영속성 컨텍스트와 관계가 없을 때  
    > 영속 상태(Persistent) : 엔티티가 영속성 컨텍스트에 의해 관리될 때  
    > 준영속 상태(Detached) : 엔티티가 영속성 컨텍스트에서 분리된 상태일 때  
    > 삭제 상태(Removed) : 엔티티가 삭제될 때  

- 엔티티 매니저(EntityManager)

  엔티티 매니저는 JPA의 핵심 인터페이스로, 엔티티의 생명주기를 관리하고 데이터베이스 연산을 처리합니다. 엔티티 매니저는 영속성 컨텍스트를 생성하고, 엔티티를 저장(persist), 조회(find), 수정(merge), 삭제(remove)할 수 있습니다.

  > 주요 메서드
  >
  > persist(entity) : 엔티티를 영속성 컨텍스트에 저장합니다.
  > find(entityClass, primaryKey) : 엔티티를 기본 키로 조회합니다.
  > merge(entity) : 엔티티의 상태를 갱신합니다.
  > remove(entity) : 엔티티를 영속성 컨텍스트에서 제거합니다.

- 영속성 유닛(Persistence Unit)

  영속성 유닛은 JPA 설정의 기본 단위로, 엔티티 클래스와 데이터 소스의 설정을 포함합니다. persistence.xml 파일에 정의되며, 영속성 유닛은 특정 데이터베이스와 연결된 엔티티 클래스들의 집합을 나타냅니다.

  - persistence.xml 설정 파일 예

    ```xml
    <persistence xmlns="http://xmlns.jcp.org/xml/ns/persistence" version="2.2">
        <persistence-unit name="myPersistenceUnit">
            <provider>org.hibernate.jpa.HibernatePersistenceProvider</provider>
            <class>com.example.entity.User</class>
            <properties>
                <property name="javax.persistence.jdbc.url" value="jdbc:mysql://localhost:3306/mydb"/>
                <property name="javax.persistence.jdbc.user" value="user"/>
                <property name="javax.persistence.jdbc.password" value="password"/>
                <property name="javax.persistence.jdbc.driver" value="com.mysql.cj.jdbc.Driver"/>
                <property name="hibernate.dialect" value="org.hibernate.dialect.MySQL5Dialect"/>
            </properties>
        </persistence-unit>
    </persistence>
    ```

- JPQL (Java Persistence Query Language)

  JPQL은 JPA에서 제공하는 객체 지향 쿼리 언어로, SQL과 유사하지만 엔티티 객체를 대상으로 쿼리를 작성합니다. JPQL은 데이터베이스 독립적이며, 데이터베이스 테이블이 아닌 엔티티 객체와 속성을 대상으로 합니다.

  - 기본 JPQL 쿼리 예

    ```java
    TypedQuery<User> query = em.createQuery("SELECT u FROM User u WHERE u.username = :username", User.class);
    query.setParameter("username", "john");
    List<User> results = query.getResultList();
    ```
    
- 트랜잭션 관리

  JPA는 데이터베이스 트랜잭션을 관리하는 기능을 제공합니다. 트랜잭션은 엔티티 매니저를 통해 시작되고, 커밋 또는 롤백할 수 있습니다.

  - 트랜잭션 시작과 종료 예

    ```java
    EntityTransaction tx = em.getTransaction();
    try {
        tx.begin();
        // 작업 수행
        tx.commit();
    } catch (Exception e) {
        tx.rollback();
    }
    ```

  - 트랜잭션 전파 및 격리 수준

    JPA에서는 트랜잭션 전파 방식과 격리 수준을 설정할 수 있으며, 이를 통해 트랜잭션이 다른 트랜잭션과 어떻게 상호 작용하는지를 제어할 수 있습니다.

- 캐시

  JPA는 1차 캐시와 2차 캐시를 통해 성능을 최적화할 수 있습니다.

  - 1차 캐시

    엔티티 매니저 내에서 사용되는 캐시로, 같은 트랜잭션 내에서 반복적인 데이터베이스 접근을 줄여줍니다.

  - 2차 캐시

    애플리케이션 레벨에서 사용되는 캐시로, 엔티티 매니저 간에 데이터를 공유하여 성능을 향상시킵니다.

<br>

## 장단점
---
- 장점
  - 객체 지향 프로그래밍과의 일관성

    JPA는 객체 지향적인 방식으로 데이터베이스와 상호작용할 수 있게 해줍니다. 데이터베이스 연산을 자바 객체를 통해 수행하므로 객체 지향 설계와 잘 맞습니다.

  - 생산성 향상

    개발자가 SQL을 직접 작성하지 않아도 되므로, 데이터베이스 연산에 소요되는 시간을 줄이고 생산성을 높입니다. 엔티티 클래스를 통해 데이터베이스 테이블과 매핑하므로 코드 작성이 간편해집니다.

  - 데이터베이스 독립성

    JPA는 데이터베이스 독립적인 애플리케이션 개발을 가능하게 합니다. 특정 데이터베이스에 종속되지 않으므로, 데이터베이스 변경 시 애플리케이션 코드 변경을 최소화할 수 있습니다.

  - 표준화

    JPA는 자바 EE의 표준이므로, 다양한 구현체(Hibernate, EclipseLink 등)를 자유롭게 선택할 수 있습니다. 특정 구현체에 종속되지 않고 유연한 개발이 가능합니다.

  - 캐싱

    JPA는 1차 캐시와 2차 캐시를 통해 성능을 최적화합니다. 반복적인 데이터베이스 접근을 줄여 성능을 높일 수 있습니다.

  - 트랜잭션 관리

    JPA는 트랜잭션 관리를 통해 데이터의 일관성과 무결성을 보장합니다. 개발자는 트랜잭션 시작, 커밋, 롤백 등을 간단하게 관리할 수 있습니다.

<br>

- 단점
  - 복잡한 설정

    JPA 설정은 처음 학습하기에 다소 복잡할 수 있습니다. persistence.xml 파일 설정, 엔티티 클래스 매핑, 영속성 유닛 설정 등 다양한 설정이 필요합니다.

  - 성능 이슈

    JPA는 ORM을 통해 데이터베이스와 상호작용하므로, 직접 SQL을 작성하는 것보다 성능이 떨어질 수 있습니다. 특히 복잡한 쿼리나 대량의 데이터 처리가 필요한 경우 성능 최적화가 어렵습니다.

  - 높은 학습 곡선

    JPA는 기능이 많고 복잡하므로, 처음 학습하는 데 시간이 많이 걸릴 수 있습니다. 엔티티 매핑, JPQL, 트랜잭션 관리 등 다양한 개념을 이해해야 합니다.

  - N+1 문제

    지연 로딩을 잘못 사용하면 N+1 문제가 발생할 수 있습니다. 이는 하나의 쿼리로 인해 추가적인 N개의 쿼리가 발생하여 성능을 저하시키는 문제입니다.

  - 디버깅의 어려움

    JPA는 내부적으로 많은 작업을 처리하므로, 문제가 발생했을 때 디버깅이 어려울 수 있습니다. SQL이 자동으로 생성되므로, 생성된 SQL을 이해하고 문제를 해결하는 데 어려움을 겪을 수 있습니다.

<br>

## 미래 전망
---
JPA(Java Persistence API)는 자바 애플리케이션에서 데이터베이스 연동을 간소화하는 강력한 ORM(Object-Relational Mapping) 기술로 자리 잡고 있습니다. 여러 해 동안 발전을 거듭하며 많은 기업과 개발자들이 채택하고 있습니다. JPA의 미래 전망을 다음과 같이 예상할 수 있습니다.

- 지속적인 발전

  JPA는 자바 EE와 자바 SE 플랫폼의 핵심 요소로서, 지속적으로 발전할 것입니다. 새로운 버전이 출시될 때마다 더 나은 성능, 새로운 기능, 향상된 개발자 경험을 제공할 것입니다.

- 마이크로서비스 아키텍처와의 통합

  마이크로서비스 아키텍처가 인기를 끌면서 JPA는 마이크로서비스 환경에서 효율적으로 동작할 수 있도록 더 많은 지원을 받을 것입니다. 이를 통해 각 서비스가 독립적으로 데이터베이스를 관리하고, 분산 데이터 관리를 용이하게 할 수 있습니다.

- 클라우드 네이티브 애플리케이션 지원

  클라우드 환경이 보편화됨에 따라 JPA는 클라우드 네이티브 애플리케이션에서 더욱 중요한 역할을 할 것입니다. 클라우드 기반 데이터베이스와의 통합, 스케일링, 성능 최적화 등의 기능이 강화될 것입니다.

- 성능 최적화 및 새로운 데이터베이스 지원

  JPA는 성능 최적화에 중점을 두고 발전할 것입니다. 또한, NoSQL 데이터베이스와 같은 새로운 유형의 데이터베이스와의 호환성도 증가할 것입니다.

- 커뮤니티와 생태계 확장

  JPA와 관련된 커뮤니티와 생태계가 계속 확장될 것입니다. 이를 통해 더 많은 오픈 소스 프로젝트, 도구, 확장 기능이 제공되어 개발자들이 JPA를 효율적으로 활용할 수 있을 것입니다.

<br>

## 활용 팁
---
- 올바른 엔티티 설계
  - 명확한 도메인 모델 정의
  
    도메인 모델을 명확히 정의하고, 각 엔티티의 책임과 관계를 잘 설계해야 합니다. 엔티티 설계가 잘못되면 성능 문제나 유지보수 어려움이 발생할 수 있습니다.

  - 적절한 관계 매핑 사용

    일대일, 일대다, 다대일, 다대다 관계를 올바르게 매핑해야 합니다. 관계 매핑을 잘못하면 N+1 문제나 불필요한 데이터 로딩이 발생할 수 있습니다.

- 성능 최적화
  - 지연 로딩과 즉시 로딩의 적절한 사용

    지연 로딩(Lazy Loading)과 즉시 로딩(Eager Loading)을 적절히 사용하여 성능을 최적화해야 합니다. 지연 로딩은 필요할 때만 데이터를 로딩하므로 성능을 향상시킬 수 있지만, 잘못 사용하면 N+1 문제를 초래할 수 있습니다.

  - 캐시 사용

    JPA의 1차 캐시와 2차 캐시를 적절히 활용하여 반복적인 데이터베이스 접근을 줄이고 성능을 최적화합니다.

  - 배치 처리

    대량의 데이터를 처리할 때는 배치 처리를 사용하여 성능을 최적화할 수 있습니다. 이는 데이터베이스와의 상호작용을 줄이고, 효율적으로 데이터를 처리하는 데 도움이 됩니다.

- 트랜잭션 관리
  - 트랜잭션 범위 설정

    트랜잭션의 범위를 적절히 설정하여 데이터의 일관성과 무결성을 보장해야 합니다. 불필요하게 긴 트랜잭션 범위는 성능 저하를 초래할 수 있습니다.

  - 트랜잭션 전파 및 격리 수준 설정

    트랜잭션 전파와 격리 수준을 적절히 설정하여, 트랜잭션 간의 상호작용을 제어하고, 동시성 문제를 해결합니다.

- 효율적인 쿼리 작성
  - JPQL과 크리테리아 API 사용

    JPQL(Java Persistence Query Language)과 크리테리아 API를 사용하여 복잡한 쿼리를 효율적으로 작성할 수 있습니다.

  - 네이티브 쿼리 사용

    필요한 경우 네이티브 SQL 쿼리를 사용하여 더 효율적인 데이터베이스 접근을 할 수 있습니다.

- 테스트 코드 작성
  - 단위 테스트와 통합 테스트

    JPA 애플리케이션의 안정성을 보장하기 위해 단위 테스트와 통합 테스트를 작성해야 합니다. 이를 통해 데이터베이스 연산이 올바르게 수행되는지 검증할 수 있습니다.

  - 테스트용 인메모리 데이터베이스 사용

    H2와 같은 인메모리 데이터베이스를 사용하여 빠르고 효율적인 테스트 환경을 구성할 수 있습니다.

- 문서화
  - 설정과 코드를 문서화

    JPA 설정 파일과 엔티티 클래스를 문서화하여 유지보수 용이성을 높여야 합니다. 코드 주석과 함께 명확한 문서를 작성하면 협업과 유지보수에 큰 도움이 됩니다.

- 최신 정보 학습
  - JPA와 Hibernate의 최신 버전 학습

    JPA와 Hibernate의 최신 버전과 새로운 기능을 지속적으로 학습하여 최신 기술을 활용할 수 있어야 합니다. 커뮤니티와 공식 문서를 통해 최신 정보를 얻는 것이 중요합니다.

---

읽어주셔서 감사합니다. 😊 

__Reference__  
ChatGPT - OpenAI